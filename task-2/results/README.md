# Ежедневная выгрузка прайс-листов: обоснование выбора решения

## Выбор решения

**K8s CronJob + лёгкий экспортёр (Go)**

**Обоснование:** минимальная сложность, встроенное CRON-расписание, низкое потребление ресурсов, простая интеграция с K8s и микросервисами. Для задачи с небольшим объёмом данных (5-10k строк) и простой логикой другие решения (Airflow, Spark) избыточны.

---

## Сравнение вариантов

| Критерий                      | K8s CronJob       | Spring Batch           | Apache Airflow | Apache Spark |
|:------------------------------|:------------------|:-----------------------|:---------------|:-------------|
| **CRON-расписание**           | Встроено          | Требует доп. настройки | Встроено       | Нет          |
| **Сложность реализации**      | Низкая            | Средняя                | Высокая        | Высокая      |
| **Ресурсоёмкость**            | Очень низкая      | Низкая                 | Высокая        | Высокая      |
| **Масштабируемость**          | Простая           | Умеренная              | Высокая        | Высокая      |
| **Сложность развёртывания**   | Минимальная       | Низкая                 | Высокая        | Высокая      |
| **Интеграция с логированием** | Нативная (stdout) | Хорошая                | Хорошая        | Средняя      |

---

## План реализации

1. **Экспортёр (Go сервис)**
    - Подключение к PostgreSQL
    - Выполнение JOIN запроса к таблицам `products`, `categories`, `client_prices`
    - Потоковая запись CSV/XLSX файлов
    - Загрузка в S3-хранилище

2. **Контейнеризация**
    - Docker-образ с экспортёром
    - Подключение к БД и S3 через K8s Secrets

3. **K8s CronJob**
    - Расписание: ежедневно в 06:00
    - Запуск Pod с экспортёром
    - Настройка retry и лимитов

4. **Наблюдаемость**
    - Логирование в stdout
    - Метрики в Prometheus

**Результат:** автоматическая ежедневная генерация прайс-листов для B2B-клиентов.