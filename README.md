# Проект: Многоуровневое ETL-решение с мониторингом и трейсингом

## Описание

Этот репозиторий содержит серию задач, демонстрирующих различные подходы к реализации ETL (Extract, Transform, Load) процессов и сопутствующей инфраструктуры, включая мониторинг, логирование и трейсинг. Каждая задача представляет собой отдельный этап развития решения или альтернативный подход.

## Содержание задач

### Task 1: Apache Airflow для гибких пайплайнов
*   **Цель:** Реализовать ETL-процесс с использованием Apache Airflow.
*   **Решение:** Использование DAG-ов, операторов ветвления и условных операторов.
*   **Инструменты:** Apache Airflow, Docker Compose, MailHog (для уведомлений).
*   **Особенности:** Визуальный интерфейс, гибкая оркестрация, интеграция с внешними системами.

### Task 2: K8s CronJob для ежедневной выгрузки
*   **Цель:** Создать ежедневную задачу выгрузки прайс-листов.
*   **Решение:** K8s CronJob + лёгкий экспортёр на Go.
*   **Обоснование:** Простота, встроенное CRON-расписание, низкая ресурсоёмкость.
*   **Инструменты:** Kubernetes, Go, Docker, PostgreSQL.

### Task 3: Kubernetes CronJob для выгрузки в CSV
*   **Цель:** Автоматическая ежеминутная выгрузка данных из PostgreSQL в CSV.
*   **Решение:** Java-экспортёр, запускаемый через K8s CronJob.
*   **Инструменты:** Java, Kubernetes, PostgreSQL, Docker.
*   **Особенности:** Использование ConfigMaps и Secrets для конфигурации и безопасности.

### Task 4: Spring Batch для ETL
*   **Цель:** Реализовать ETL-процесс с использованием Spring Batch.
*   **Решение:** Spring Batch как отдельный ETL-сервис.
*   **Требования:** Поддержка CSV, валидация, обогащение, загрузка в БД, REST API, наблюдаемость.
*   **Инструменты:** Spring Boot, Spring Batch, PostgreSQL, GCS (Google Cloud Storage), Docker, Prometheus, Grafana.

### Task 5: Добавление мониторинга, логирования и трейсинга
*   **Цель:** Интеграция инструментов наблюдаемости в ETL-процесс (на примере Task 4).
*   **Решение:** Внедрение стека ELK (Elasticsearch, Logstash, Kibana) для логов, Prometheus + Grafana для метрик, Zipkin для трейсинга.
*   **Инструменты:** Prometheus, Grafana, Elasticsearch, Logstash, Kibana, Zipkin, Filebeat, Docker Compose.
*   **Особенности:** Централизованное логирование, визуализация метрик, трассировка вызовов.

### Task 6: Доработка Task 5
*   **Цель:** Интеграция Zipkin в существующую инфраструктуру Task 5.
*   **Решение:** Добавление зависимости и сервиса Zipkin к проекту Task 5.
*   **Инструменты:** Spring Cloud Sleuth, Zipkin, Docker Compose.
*   **Особенности:** Анализ задержек и пути вызовов внутри ETL-процесса.

## Общая архитектура (Task 4-6)

*   **`app`**: Основное Spring Boot / Spring Batch приложение (Task 4-6).
*   **`postgresdb`**: База данных PostgreSQL.
*   **`prometheus`**: Сбор метрик.
*   **`grafana`**: Визуализация метрик.
*   **`elasticsearch`**: Хранилище логов и поисковый движок.
*   **`logstash`**: Обработка логов.
*   **`kibana`**: Веб-интерфейс для логов.
*   **`filebeat`**: Сбор логов из контейнеров.
*   **`zipkin`**: Служба трейсинга.
*   **`airflow`**: (Task 1) Платформа оркестрации.
*   **`mailhog`**: (Task 1) Тестовый SMTP-сервер.

## Запуск задач

Для запуска конкретной задачи перейдите в соответствующую поддиректорию и следуйте инструкциям в `README.md` внутри неё.

## Структура репозитория
    
    ├── task-1/ # Apache Airflow
    ├── task-2/ # K8s CronJob + Go
    ├── task-3/ # K8s CronJob + Java
    ├── task-4/ # Spring Batch
    ├── task-5/ # Мониторинг/логирование/трейсинг
    ├── task-6/ # Доработка Task 5
    └── README.md # Этот файл
